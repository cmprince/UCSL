---
title: 'UCSL: R Challenge 1'
author: "Christopher Prince"
date: "07/07/2015"
output: pdf_document
---

```{r setup, echo=FALSE}
#set display options for output values in document
options('scipen'=2, 'digits' = 2)
```

#Complete January 2015 data set

For the first part of the challenge, we are asked to provide the basic descriptive statistics for the Citibike data set from January 2015. We begin by importing the .csv data into a data frame named `cbdata`:

```{r}
#import Jan 2015 CitiBike data from csv file, include a header line
fname <- '~/UCSL/R/ch1/201501-citibike-tripdata.csv'
cbdata <- read.csv(fname, header = TRUE)
```

The statistics for the total data set are calculated below.

```{r}
#calculate descriptive stats and save in variables
#tdur is shorthand for tripduration
cbdata.count <- dim(cbdata)[1]  #1st element of dim() vector is the number of observations

tdur.mean <- mean(cbdata$tripduration)
tdur.var <- var(cbdata$tripduration)
tdur.sd <- sd(cbdata$tripduration)
tdur.min <- min(cbdata$tripduration)
tdur.max <- max(cbdata$tripduration)
tdur.range <- tdur.max - tdur.min
tdur.median <- median(cbdata$tripduration)
tdur.qtile <- quantile(cbdata$tripduration)
```

`tdur.qtile` is the vector of values associated with the quantiles. After reporting them, we use the fourth and second elements (corresponding to the first and third quartiles) to calculate the *inner quartile range*:

```{r}
tdur.qtile
tdur.iqr = tdur.qtile[4]-tdur.qtile[2]
```

|symbol         |description                        |value           |
|:--------------|:---------------------------------:|---------------:|
|`cbdata.count` |number of observations in `cbdata` |`r cbdata.count`|
|`tdur.mean`    |mean trip duration                 |`r tdur.mean`   |  
|`tdur.var`     |variance of trip duration          |`r round(tdur.var, 0)`|
|`tdur.sd`      |standard deviation of trip duration|`r tdur.sd`     |
|`tdur.median`  |median trip duration               |`r tdur.median` |
|`tdur.min`     |minimum trip duration              |`r tdur.min`    |
|`tdur.max`     |maximum trip duration              |`r tdur.max`    |
|`tdur.range`   |total range of trip duration values|`r tdur.range`  |
|`tdur.iqr`     |inner quartile range of trip duration values|`r tdur.iqr`|

#Removing outliers
Outliers are then removed by *z*-score. Observations with a *z*-score greater than 3 (more than three standard deviations from the mean) are removed from the set using the `subset` function:

```{r}

#COMPUTING Z-SCORE [from JCB code]
z_sc <- (cbdata$tripduration-tdur.mean)/tdur.sd
#creating subset of data for z_sc<3
cbdata.z3 <- subset(cbdata, z_sc<3)
```

The same statistics are calculated for the subset:

```{r}
# Computing same calculation for data without outliers

cbdata.z3.count <- dim(cbdata.z3)[1]
tdur.z3.mean <- mean(cbdata.z3$tripduration)
tdur.z3.var <- var(cbdata.z3$tripduration)
tdur.z3.sd <- sd(cbdata.z3$tripduration)
tdur.z3.min <- min(cbdata.z3$tripduration)
tdur.z3.max <- max(cbdata.z3$tripduration)
tdur.z3.range <- tdur.z3.max - tdur.z3.min
tdur.z3.median <- median(cbdata.z3$tripduration)
tdur.z3.qtile <- quantile(cbdata.z3$tripduration)

tdur.z3.qtile
tdur.z3.iqr = tdur.z3.qtile[4]-tdur.z3.qtile[2]

```

|symbol         |description                        |value           |
|:--------------|:---------------------------------:|---------------:|
|`cbdata.z3.count` |number of observations in `cbdata.z3` |`r cbdata.z3.count`|
|`tdur.z3.mean`    |mean trip duration                 |`r tdur.z3.mean`   |  
|`tdur.z3.var`     |variance of trip duration          |`r round(tdur.z3.var, 0)`|
|`tdur.z3.sd`      |standard deviation of trip duration|`r tdur.z3.sd`     |
|`tdur.z3.median`  |median trip duration               |`r tdur.z3.median` |
|`tdur.z3.min`     |minimum trip duration              |`r tdur.z3.min`    |
|`tdur.z3.max`     |maximum trip duration              |`r tdur.z3.max`    |
|`tdur.z3.range`   |total range of trip duration values|`r tdur.z3.range`  |
|`tdur.z3.iqr`     |inner quartile range of trip duration values|`r tdur.z3.iqr`|

The **central tendency** for the data in January, after removing the *z*>3 outliers, is that the average (mean) trip duration is slightly more than 10 minutes (`r tdur.z3.mean` sec). Half of the trips took less than the median time of `r tdur.z3.median` sec, about 8 1/2 minutes.

The **dispersion** of the data in January indicate that the middle half of all rides (again, after removing the *z*>3 outliers), given by the IQR spanned a range of `r tdur.z3.iqr` sec. The total range for all of the data is a little under an hour, `r tdur.z3.range` sec.

**Removing outliers** had little effect on the quartile calculations: the median shifted just `tdur.median - tdur.z3.median = ` `r tdur.median-tdur.z3.median` sec, and the IQR was reduced by only `tdur.iqr - tdur.z3.iqr = ` `r tdur.iqr-tdur.z3.iqr` sec. However, the mean shifted by a significant amount, `tdur.mean - tdur.z3.mean = ` `r tdur.mean-tdur.z3.mean` sec. This is due to removing `cbdata.count - cbdata.z3.count =` `r cbdata.count - cbdata.z3.count` data points skewing the mean. The overall range reduced from `r tdur.range` sec to `r tdur.z3.range` sec.

#Histograms of 
```{r}
#histograms of tdur and log(tdur) for all data points and the z_sc<3 subset
par(mfrow=c(2,2))
hist(cbdata$tripduration, main = "Trip Duration", xlab = "time (sec)", col='blue')
hist(log(cbdata$tripduration), main = "log(Trip Duration)", xlab = "log(time (sec))", col='blue')
hist(cbdata.z3$tripduration, main = "Trip Duration, z_sc<3", xlab = "time (sec)", col='orange')
hist(log(cbdata.z3$tripduration), main = "log(Trip Duration), z_sx<3", xlab = "log(time (sec))", col='orange')
```

#Visualization by `usertype`
First we use the `subset` function to parse out new data frames by `usertype`. There are two `usertype`s, `Subscriber` and `Customer`. After creating the subsets for both the full data set and the *z*-score reduced set, we count the observations and verify that we haven't missed any blanks or mislabeled points.

```{r}
#create subsets by usertype
cbdata.subs <- subset(cbdata, cbdata$usertype=='Subscriber')
cbdata.cust <- subset(cbdata, cbdata$usertype=='Customer')
cbdata.z3.subs <- subset(cbdata.z3, cbdata.z3$usertype=='Subscriber')
cbdata.z3.cust <- subset(cbdata.z3, cbdata.z3$usertype=='Customer')

#count the elements of the subsets
cbdata.cust.count <- dim(cbdata.cust)[1]
cbdata.subs.count <- dim(cbdata.subs)[1]
cbdata.z3.cust.count <- dim(cbdata.z3.cust)[1]
cbdata.z3.subs.count <- dim(cbdata.z3.subs)[1]
```
||**Complete data set**|**Outlier-removed set**|
|subset sums|cbdata.cust.count + cbdata.subs.count|cbdata.z3.cust.count + cbdata.z3.subs.count|
|total counts|cbdata.count|cbdata.z3.count|
```{r}
#verify that the subsets capture all data (i.e., check for blank or mislabeled usertype)
test_msg <- 'Counts match!'    #assume equal
if (cbdata.cust.count + cbdata.subs.count !=cbdata.count) {test_msg <- 'Counts do not match!'} #change msg if not eq.
test_msg   #print message
```


```{r}
#histograms of tdur by usertype for z_sc<3 subsets
par(mfrow=c(2,2))
hist(cbdata.z3.subs$tripduration, main = "Subscriber Trip Duration", xlab = "time (sec)", col='red')
hist(log(cbdata.z3.subs$tripduration), main = "log(Subscriber Trip Duration)", xlab = "log(time (sec))", col='red')
hist(cbdata.z3.cust$tripduration, main = "Customer Trip Duration", xlab = "time (sec)", col='red')
hist(log(cbdata.z3.cust$tripduration), main = "log(Customer Trip Duration)", xlab = "log(time (sec))", col='red')

#and boxplots of same
boxplot(cbdata.z3.subs$tripduration, main='Boxplot of subscriber Trip Duration', xlab='time(sec)')
boxplot(log(cbdata.z3.subs$tripduration), main='Boxplot of subscriber Trip Duration', xlab='log(time(sec))')
boxplot(cbdata.z3.cust$tripduration, main='Boxplot of subscriber Trip Duration', xlab='time(sec)')
boxplot(log(cbdata.z3.cust$tripduration), main='Boxplot of subscriber Trip Duration', xlab='log(time(sec))')

#alternate presentation
par(mfrow=c(1,2))
boxplot(tripduration ~ usertype, data=cbdata.z3)
boxplot(log(tripduration) ~ usertype, data=cbdata.z3)
```
